name: Acceptance tests
on:
  push:
    branches-ignore:
      - main
  workflow_call:

jobs:

  build:
    uses: ./.github/workflows/build.yml

  functional:
    runs-on: ubuntu-latest
    steps:
      - name: Download sources
        uses: actions/checkout@v4
      - name: Download tools
        run: |
          cd frontend; npm install --save-dev @badeball/cypress-cucumber-preprocessor
      - name: Install and launch application
        uses: ./.github/actions/launch
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
      - name: Run tests
        run: |
          cd frontend; npx cypress run --config baseUrl=http://localhost

  footprint:
    runs-on: ubuntu-latest
    steps:
      - name: Download sources
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Greenframe needs the whole history
      - name: Download tools
        run: |
          curl https://assets.greenframe.io/install.sh | bash
      - name: Install and launch application
        uses: ./.github/actions/launch
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
      - name: Measure carbon footprint
        run: |
          cd requirements
          greenframe analyze >> $GITHUB_STEP_SUMMARY

